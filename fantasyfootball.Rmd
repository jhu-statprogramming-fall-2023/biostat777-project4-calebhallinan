---
title: "Analysis on my 2023 Fantasy Football League"
output: 
  flexdashboard::flex_dashboard:
    theme: readable
    orientation: columns
    source_code: embed
    vertical_layout: fill
runtime: shiny
---


<style type="text/css">
  p {font-size: 30px;}
</style>


```{r setup, include=FALSE, message = FALSE, warning = FALSE}
library(flexdashboard)
# Read in my package ahead of time
library(tidyverse)
library(here)
library(ggplot2)
library(paletteer)
library(stringr)
```



<!-- ```{r data, eval = FALSE} -->
<!-- # Test if a "data" directory exists locally; if not, create it -->
<!-- if(!dir.exists(here("data"))) { dir.create(here("data")) } -->

<!-- # Save the data only once (not each time the R Markdown document is knit) -->
<!-- if(!file.exists(here("data","olympics.csv"))) { -->
<!--   url_csv <- 'https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-07-27/olympics.csv' -->
<!--   olympics <- read_csv(url_csv) -->

<!--   # Save the olympics file to a csv object -->
<!--   readr::write_csv(x = olympics, file = here("data","olympics.csv")) -->
<!-- } -->
<!-- ``` -->


```{r data, include=FALSE}
# check data directory, make it
if(!dir.exists(here("data"))) { 
  print("No data folder, so creating now...")
  dir.create(here("data"))
  }

# Save  data only once (not each time the R Markdown document is knit)
if(!file.exists(here("data","league_data_2023_deidentified.csv"))) {
  print("Can't find data, downloading from internet now.")
  url_csv <- 'https://raw.githubusercontent.com/calebhallinan/fantasy_football_2023/main/data/league_data_2023_deidentified.csv'
  data <- read_csv(url_csv)
  # Save the olympics file to a csv object
  readr::write_csv(x = data, file = here("data","league_data_2023_deidentified.csv"))
}

# Save  data only once (not each time the R Markdown document is knit)
if(!file.exists(here("data","league_matchups_2023_deidentified.csv"))) {
  print("Can't find data, downloading from internet now.")
  url_csv <- 'https://raw.githubusercontent.com/calebhallinan/fantasy_football_2023/main/data/league_matchups_2023_deidentified.csv'
  data <- read_csv(url_csv)
  # Save the olympics file to a csv object
  readr::write_csv(x = data, file = here("data","league_matchups_2023_deidentified.csv"))
}


# Read in the data locally (each time the R Markdown document is knit)
data = readr::read_csv("data/league_data_2023_deidentified.csv")
matchups = readr::read_csv("data/league_matchups_2023_deidentified.csv")
```


# About {data-icon="ion-android-home"}

## Column {data-width=500}

### Fantasy Footbal Logo

```{r, echo=FALSE, fig.cap="[Fantasy Football Logo](https://espnpressroom.com/us/press-releases/2016/08/espn-fantasy-footballs-21st-season-comprehensive-coverage-ever/)", out.width = '100%'}
knitr::include_graphics(here("data/fantasy_football.webp"))
```


## Column {data-width=500}


### 

**Goals of this dashboard**

Fantasy Football



### 

**Data Source**

XXXX



# The Data {data-icon="ion-android-list"}

**About the data**

This dashboard XXX

## Column {data-width=500}

### Player Data


```{r data_shown, echo=FALSE}
# Make the DT table
DT::renderDataTable({
  DT::datatable(data,
                options = list(autoWidth = TRUE,
                               pageLength = 10,
                               scroller = TRUE,
                               scrollY = '500px'))
})
```

## Column {data-width=500}

### Matchup Data 

```{r matchup_shown, echo=FALSE}
# Make the DT table
DT::renderDataTable({
  DT::datatable(matchups,
                options = list(autoWidth = TRUE,
                               pageLength = 10,
                               scroller = TRUE,
                               scrollY = '500px'))
})
```


# Static {data-icon="ion-ios-americanfootball-outline"}

## Column {data-width=650}


### Chart A

```{r}
# plot showing weekly projections to actual score
# data
data|>
  # groupby team name and week
  group_by(TeamName, Week)|>
  # get rid of bench players as they don't count towards score
  filter(PlayerRosterSlot != "Bench")|>
  # get the sum of your actual player roster and projected 
  summarize(weekly_score = sum(PlayerScoreActual),
            projected_weekly_score = sum(PlayerScoreProjected))|>
  # begin plotting
  ggplot(aes(x = Week, y = weekly_score, color = TeamName)) +
  # add solid line for actual total
  geom_line(aes(linetype = "solid", show.legend = FALSE)) +
  # dashed line for projected total
  geom_line(aes(y = projected_weekly_score, linetype = "dashed")) +
  # add point to easily see week
  geom_point(aes(y=weekly_score), size=1) +
  # average projected
  # geom_hline(aes(yintercept=mean(projected_weekly_score), linetype = "dotted", color="red")) +
  # facet wrap by teamname
  facet_wrap(~ TeamName) +
  # add labels
  labs(
    title = "Weekly Actual and Projected Scores by Team", 
    x = "Week", 
    y = "Scores",
    caption = "Data Source: ESPN Fantasy Website",
    subtitle = str_wrap("The plot reveals several interesting trends. Notably, Team BD and Team JN consistently maintain 
                        a steady average of projected points per week. Meanwhile, teams such as myself and Team BL have
                        experienced a mix of both impressive and lackluster weeks. On the other hand, Team GM has had an
                        incredible season so far, consistently delivering outstanding performances week after week.
                        Lastly, a few teams like Team RW and Team TP have notably underperformed in multiple weeks.",
                        width = 87)) +
  # add manual labels
  scale_linetype_manual(values = c("dashed", "solid"), labels = c("Projected", "Actual")) +
  # set y limit
  ylim(50, 180) +
  # set colors for teams
  scale_colour_manual(values = paletteer_d("ggprism::colors", 12)) +
  # get rid of color legend but use linetype legend
  guides(color = "none", linetype = guide_legend(title = "Scores")) +
  # use classic theme
  theme_classic() + 
  # edit text and legend
  theme(axis.text.x = element_text(size = 12),
  axis.text.y = element_text(size = 12),
  plot.title = element_text(face= "bold", hjust = 0.5),
  legend.position = c(.98, -0.12), legend.justification = c(1, 0)) +
  scale_x_continuous(breaks = c(2, 4, 6, 8,10,12))
```



# Static {data-icon="ion-ios-americanfootball"}

# Interactive {data-icon="ion-flag" data-orientation=rows}

## {data-height=1000}

```{r}
# Define the desired order of the positions
position_order <- c("K", "D/ST","TE", "FLEX","WR","RB", "QB")

# get abs of difference and plot
renderPlot({ 
# get data
data |> 
  filter(!Week %in% c(as.numeric(input$Week):17)) |> 
  # group by teamname and week
  group_by(TeamName, PlayerRosterSlot) |> 
  # filter IR players out
  filter(PlayerRosterSlot != "IR") |>
  # gilter bench players out
  filter(PlayerRosterSlot != "Bench") |>
  # get sum of weekly score
  summarise(total_score_per_position = sum(PlayerScoreActual))  |> 
  # factor rosterslot
  mutate(PlayerRosterSlot = factor(PlayerRosterSlot, levels = position_order)) |> 
  # plot in ggplot
  ggplot(aes(x = TeamName, y = total_score_per_position, fill = PlayerRosterSlot)) +    
  # geom bar of all positions
  geom_bar(position="dodge", stat="identity") +
    # change colors and add percent to y axis
    # scale_colour_manual(values = paletteer_d("ggprism::colors", 12)) +
  # labels
  labs(
      x = "Team Name",
      y = paste0("Total Scores (Through Week ",as.numeric(input$Week),")"),
      fill = "Positions",
      title = "Total Score of Each Position For All Teams",
      caption = "Data Source: ESPN Fantasy Website",
      subtitle = "Expresses which position scores the most points for each team and how many thoughout the season.") +
  # change theme to linedraw
  theme_linedraw() + 
  # edit text
  theme(axis.text.x = element_text(angle = 45, hjust = 1), 
    text = element_text(size = 16),
    plot.title = element_text(face = "bold", hjust = 0.5, size = 20)) +
  # add colors to each position
  scale_fill_manual(values = paletteer_d("NatParksPalettes::GrandCanyon", 7)) +
    ylim(0,450)
})

```


## Column {.sidebar} {data-height=200}

```{r slider input, message = FALSE, warning = FALSE}
sliderInput("Week", label = "Number of Weeks to Include:",
            min = 1, max = 14, value = 1, step = 1, width = "100%")
```




# Interactive {data-icon="fa-medal"}

# Analysis {data-icon="ion-ios-pie"}


